{% extends 'base.html' %}
{% block title %}Patient Details{% endblock %}
{% block content %}
<div class="card">
  <div class="card-header bg-white d-flex justify-content-between align-items-center">
    <h1 class="h3 mb-0">Patient: {{ patient.name }}</h1>
    <a href="{{ url_for('main.patient_list') }}" class="btn btn-secondary"><i class="fa-solid fa-arrow-left"></i> Back to All Patients</a>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-6">
        <h3>Patient Information</h3>
        <p><strong>Date of Birth:</strong> {{ patient.date_of_birth.strftime('%d %B, %Y') }}</p>
        <p><strong>Medical History:</strong> {{ patient.medical_history or 'Not provided.' }}</p>
        <p><strong>Symptoms:</strong> {{ patient.symptoms or 'Not provided.' }}</p>
        {% if patient.user %}
        <p><strong>Recorded by:</strong> {{ patient.user.email }}</p>
        {% endif %}
        
        {% if patient.dr_result %}
          <hr class="my-4">
          <h3>Analysis Result</h3>
          <p>
            <strong>Diagnosis:</strong>
            <span class="badge fs-6
                {% if patient.dr_result == 'No_DR' %}bg-success
                {% elif patient.dr_result in ['Mild', 'Moderate'] %}bg-warning text-dark
                {% elif patient.dr_result in ['Severe', 'Proliferate_DR'] %}bg-danger
                {% else %}bg-secondary
                {% endif %}">
                {{ patient.dr_result | replace('_', ' ') }}
            </span>
          </p>
          <p><strong>Confidence Score:</strong> {{ (patient.dr_confidence * 100) | round(2) }}%</p>
          <a href="{{ url_for('main.download_report', patient_id=patient.id) }}" class="btn btn-primary mt-3">
            <i class="fa-solid fa-file-arrow-down"></i> Download PDF Report
          </a>
        {% endif %}
      </div>
      <div class="col-md-6">
        {% if patient.image_filename %}
          <h3 class="mb-3">Retina Image</h3>
          <img src="{{ url_for('static', filename='uploads/' ~ patient.image_filename) }}" class="img-fluid rounded border" alt="Retina image for {{ patient.name }}">
        {% else %}
          <div class="text-center text-muted p-5">
            <i class="fa-solid fa-image fa-3x"></i>
            <p class="mt-2">No image available for this patient.</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}